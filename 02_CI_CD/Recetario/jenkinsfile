pipeline {
    agent any

    tools {
        nodejs "nodejs"
    }

    stages{
        stage('paralelizar'){
            parallel{
                stage('install backend') {
                    steps{
                        git branch: 'main', url: 'https://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@github.com/Pruebas-de-Software-Github/Presentacion_02_CI_CD.git'
                        dir('Recetario/backend') {
                            // bat 'npm ci'
                            // bat 'npm i ajv-formats'
                            bat "npm i"
                            bat "node ./index.js &"
                        }
                    }
                }

                stage('install frontend') {
                    steps{
                        dir('Recetario/frontend') {
                            // bat 'npm ci'
                            // bat 'npm i ajv-formats'
                            bat 'npm install -g @angular/cli'
                            bat 'npm i'
                            bat "npm start"
                        }                
                    }
                }

                stage('tests'){
                    steps{
                        dir('Recetario/frontend'){
                            // bat 'npm ci'
                            // bat 'npm i ajv-formats'
                            bat 'npm i'
                            bat 'npm install -g @angular/cli'
                            bat 'npm run test'
                        }
                    }
                }
            }
        }
    }
}